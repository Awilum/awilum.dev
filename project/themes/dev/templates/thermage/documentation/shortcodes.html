{% extends 'themes/' ~ flextype.registry.get('plugins.site.settings.theme') ~ '/templates/partials/base.html' %}

{% block content %}

{% set uri1 = request.getUri().getPath()|split('/').2 %}
{% set uri2 = request.getUri().getPath()|split('/').3 %}
{% set uri3 = request.getUri().getPath()|split('/').4 %}

{% set gettingStartedCacheID = strings('gettingStartedCacheID' ~ 'documentation/parsers/' ~ uri1 ~ '/getting-started').hash().toString() %}
{% if flextype.cache.has(gettingStartedCacheID) %}
    {% set gettingStarted = flextype.cache.get(gettingStartedCacheID) %}
{% else %}
    {% set gettingStarted = flextype.entries.fetch('documentation/parsers/' ~ uri1 ~ '/getting-started', {'collection': true}).exceptFromCollection(['content']).sortByAsc('title') %}
    {% do flextype.cache.set(gettingStartedCacheID, gettingStarted) %}
{% endif %}

{% set shortcodesCacheID = strings('shortcodesCacheID' ~ 'documentation/parsers/' ~ uri1 ~ '/shortcodes').hash().toString() %}
{% if flextype.cache.has(shortcodesCacheID) %}
    {% set shortcodes = flextype.cache.get(shortcodesCacheID) %}
{% else %}
    {% set shortcodes = flextype.entries.fetch('documentation/parsers/' ~ uri1 ~ '/shortcodes', {'collection': true}).exceptFromCollection(['content']).sortByAsc('title') %}
    {% do flextype.cache.set(shortcodesCacheID, shortcodes) %}
{% endif %}

{% set methodsCacheID = strings('methodsCacheID' ~ 'documentation/parsers/' ~ uri1 ~ '/methods').hash().toString() %}
{% if flextype.cache.has(methodsCacheID) %}
    {% set methods = flextype.cache.get(methodsCacheID) %}
{% else %}
    {% set methods = flextype.entries.fetch('documentation/parsers/' ~ uri1 ~ '/methods', {'collection': true}).exceptFromCollection(['content']).sortByAsc('title') %}
    {% do flextype.cache.set(methodsCacheID, methods) %}
{% endif %}

<div class="text-center pt-4 pb-16 lg:pt-10 lg:pb-24">
    <h1 class="text-3xl lg:text-6xl mb-0 {% if uri3 == '' or uri2 == 'getting-started' %}uppercase{% endif %}"><a class="no-underline" href="{{ url() }}/{{ entry.id }}">{{ entry.title }}</a></h1>
    <div class="text-sm lg:text-lg">
        <span class="opacity-60"><a class="no-underline" href="{{ url() }}/documentation">DOCUMENTATION</a></span>
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline" href="{{ url() }}/documentation/parsers">PARSERS</a></span>
        {% if uri2 == 'methods' %}
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}">{{ flextype.entries.fetch('documentation/parsers/' ~ uri1).title }}</a></span>
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}/{{ uri2 }}">METHODS</a></span>
        {% endif %}
        {% if uri2 == 'shortcodes' %}
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}">{{ flextype.entries.fetch('documentation/parsers/' ~ uri1).title }}</a></span>
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}/{{ uri2 }}">SHORTCODES</a></span>
        {% endif %}
        {% if uri2 == 'getting-started' %}
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}">{{ flextype.entries.fetch('documentation/parsers/' ~ uri1).title }}</a></span>
        <span class="opacity-20">/</span>
        <span class="opacity-60"><a class="no-underline uppercase" href="{{ url() }}/documentation/parsers/{{ uri1 }}/{{ uri2 }}">GETTING STARTED</a></span>
        {% endif %}
    </div>
</div>
<div class="flex flex-wrap">
    <div class="w-full lg:w-9/12">
        {{ entry.content|shortcode|markdown|raw }}
        {% if (uri3 == '' and uri2 == 'methods') or (uri1 and uri2 == '' and uri3 == '')%}
        <h3>Methods</h3>
            <div class="table">
                <table>
                    <thead>
                        <tr class="hidden lg:table-row">
                            <th>Method</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in methods %}
                        <tr>
                            <td class="flex lg:table-cell {% if loop.last %}border-b-0{% endif %}"><a href="{{ url() }}/{{ item.id }}" class="font-normal">{{ item.title }}</a></td>
                            <td class="flex lg:table-cell {% if loop.last %}border-b-0{% endif %}">{{ item.description }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
        {% if (uri3 == '' and uri2 == 'shortcodes') or (uri1 and uri2 == '' and uri3 == '')%}
        <h3>Shortcodes</h3>
            <div class="table">
                <table>
                    <thead>
                        <tr class="hidden lg:table-row">
                            <th>Shortcode</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for item in shortcodes %}
                        <tr>
                            <td class="flex lg:table-cell {% if loop.last %}border-b-0{% endif %}"><a href="{{ url() }}/{{ item.id }}" class="font-normal">{{ item.title }}</a></td>
                            <td class="flex lg:table-cell {% if loop.last %}border-b-0{% endif %}">{{ item.description }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
    <div class="pb-4 lg:pl-10 lg:w-3/12">
        <div class="lg:sticky lg:top-0 lg:overflow-y-auto lg:max-h-screen">
            <h4 class="mb-2 mt-0">Getting Started</h4>
            <ul>
                {% for item in gettingStarted %}
                <li class="mb-2"><a href="{{ url() }}/{{ item.id }}">{{ item.title }}</a></li>
                {% endfor %}
            </ul>
            <h4 class="mt-4 mb-2">Methods</h4>
            <ul>
                {% for item in methods %}
                <li class="mb-2">
                    <a href="{{ url() }}/{{ item.id }}" class="block">
                        {{ item.title }}
                        <small class="opacity-75 block base-color">
                            {{ item.description }}
                        </small>
                    </a>
                </li>
                {% endfor %}
            </ul>
            <h4 class="mt-4 mb-2">Shortcodes</h4>
            <ul>
                {% for item in shortcodes %}
                <li class="mb-2">
                    <a href="{{ url() }}/{{ item.id }}" class="block">
                        {{ item.title }}
                        <small class="opacity-75 block base-color">
                            {{ item.description }}
                        </small>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}
